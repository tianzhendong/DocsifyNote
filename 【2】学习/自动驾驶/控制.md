## 卡尔曼滤波器Kalman Filter

实际上是一种最优化递归数字处理算法，更像是一种观测器

世界存在不确定性：

- 不存在完美的数学模型
- 系统的扰动不可控，很难建模
- 测量传感器存在误差

### 理解

![image-20210905173132258](%E6%8E%A7%E5%88%B6.assets/wNamCqHXKcWFvDJ.png)



![image-20220218235553684](%E6%8E%A7%E5%88%B6.assets/image-20220218235553684.png)

![image-20210905173216344](%E6%8E%A7%E5%88%B6.assets/tIdXx9QW1O7ak8e.png)

![image-20210905173341147](%E6%8E%A7%E5%88%B6.assets/7YipA6o9wMJxGcv.png)

### 数学基础

### 数据融合

![image-20220218235619203](%E6%8E%A7%E5%88%B6.assets/image-20220218235619203.png)

![image-20210905173849010](%E6%8E%A7%E5%88%B6.assets/SX3kdQEHL7slZrm.png)

### 协方差矩阵

![image-20220218235639500](%E6%8E%A7%E5%88%B6.assets/image-20220218235639500.png)

![image-20220218235649029](%E6%8E%A7%E5%88%B6.assets/image-20220218235649029.png)

### 状态空间方程

![image-20210905174725664](%E6%8E%A7%E5%88%B6.assets/V94MNnmaJLPYhfT.png)

![image-20210905174935436](%E6%8E%A7%E5%88%B6.assets/uxM8CWnTIf4EXmZ.png)

### 推导

![image-20210905180850500](https://i.loli.net/2021/09/05/b9ki5cNqSPgxTZW.png)

由于先验（估计、测量）没有考虑误差，都具有误差，因此根据数据融合小节进行融合，得出后验值，即卡尔曼滤波

目标：寻找Kk，使得后验值和实际值之间的误差最小，和噪声有关

![image-20210905181547718](https://i.loli.net/2021/09/05/cjU16eLKdqJQHbX.png)

![image-20210905181842077](https://i.loli.net/2021/09/05/FEwtA2RKNDQj8e5.png)

### 扩展卡尔曼滤波EKF

KF适用于线性

EKF可用于非线性



![image-20210905182912239](https://i.loli.net/2021/09/05/iuL68FRPklZYUJr.png)

![image-20210905183057719](https://i.loli.net/2021/09/05/bVW9cX8lsPZSTde.png)

### UKF

![image-20210905224617349](https://i.loli.net/2021/09/05/8oNdIQCrZPGh6gA.png)

通过上面的介绍，我们知道UKF只是将非线性函数映射通过关键点映射来实现，那么出现几个问题：

1. 关键点怎么找
2. 找到关键点后如何求出新的状态xk+1,Pk+1



## 现代控制理论

### 状态空间

![image-20210905201057059](https://i.loli.net/2021/09/05/puKY5Fn9lmrB8Hw.png)

![image-20210905201707619](https://i.loli.net/2021/09/05/nbCfDSYlTHp2ywO.png)

### 可控性

线性时不变系统的可控性

$Co=[B\ \ AB\ \  A^2B\ \ ...\ \ A^{n-1}B]$​​​​

$Co$​的秩等于n的话 ，表示可控

- 可控指的是点对点的可控，轨迹不一定
- 可控理论 上可控，显示系统需要考虑物理约束



### 可观性

可观察性是可以依一系统的输出得知其系统内部的初始状态。一系统的可观察性及可控制性有数学上的对偶关系，可控制性是指可以利用输入将系统由初始状态转换成任意的最终状态，而可观察性是指系统的输出轨迹预测其初始状态。 [1] 

一个连续时间的线性非时变系统可观察性，当且仅当下式成立：

![image-20210905201857708](https://i.loli.net/2021/09/05/B3phvLquC8NMXHG.png)

### 稳定性

![image-20210905202134556](https://i.loli.net/2021/09/05/vSMW84eDPZGKiaE.png)

**线性时不变系统**：

- 稳定的必要条件：A的特征值只有**非正**的实部

- 渐近稳定：A的特征值只有**负**的实部
- 不稳定：A的特征值存在**正**的实部

**非线性**：李雅普诺夫方法

### LQR

linear quadratic regulater线性二次型调节器

假设有一个线性系统能用状态向量的形式表示成：

![image-20210905214321691](https://i.loli.net/2021/09/05/fO2uAe5FHWtp7Lj.png)

在介绍LQR前，先简单回顾一下现代控制理论中最基本的控制器--全状态反馈控制。 

我们要设计一个状态反馈控制器 u=-kx

![image-20210905214505317](https://i.loli.net/2021/09/05/fYEzkRJe9GsXKi1.png)

对于(1)式的开环系统，由现代控制理论我们知道开环传递函数的极点就是系统矩阵A的特征值。(传递函数的分母是|sI -A|，|·|表示行列式)

状态变换矩阵A变成了(A-BK)。因此通过配置反馈矩阵K，可以使得闭环系统的极点达到我们期望的状态。注意，这种控制器的设计与输出矩阵C,D没有关系。

 那么，什么样的极点会使得系统性能很棒呢？并且，当系统变量很多的时候，即使设计好了极点，矩阵K也不好计算。    于是，LQR为我们设计最优控制器提供了一种思路。在设计LQR控制器前，我们得设计一个能量函数，最优的控制轨迹应该使得该能量函数最小。一般选取如下形式的能量函数。

![image-20210905214545813](https://i.loli.net/2021/09/05/Ixyos1kctnOTwUj.png)

其中Q是你自己设计的半正定矩阵，R为正定矩阵。

 能量函数J要最小，那么状态向量x(t)，u(t)都得小。J最小，那肯定是个有界的函数，我们能推断当t趋于无穷时，状态向量x(t)将趋于0，这也保证了闭环系统的稳定性。那输入u(t)要小是什么意思呢？它意味着我们用最小的控制代价得到最优的控制。

再来看看矩阵Q,R的选取，一般来说，Q值选得大意味着，要使得J小，那x(t)需要更小，也就是意味着闭环系统的矩阵(A-BK)的特征值处于S平面左边更远的地方，这样状态x(t)就以更快的速度衰减到0。另一方面，大的R表示更加关注输入变量u(t),u(t)的减小，意味着状态衰减将变慢。同时，Q为半正定矩阵意味着他的特征值非负，R为正定矩阵意味着它的特征值为正数。如果你选择Q,R都是对角矩阵的话，那么Q的对角元素为正数，允许出现几个0.R的对角元素只能是正数。

```matlab
K = lqr(A,B,Q,R);
```

### 观测器

![image-20210905220105310](https://i.loli.net/2021/09/05/4afqGOSHsrX3ztC.png)

![image-20210905220320629](https://i.loli.net/2021/09/05/7GbUKShsTRy26ZQ.png)

![image-20210905220443366](https://i.loli.net/2021/09/05/bq6Il4Wc39JiU5K.png)

  

![image-20210905220737139](https://i.loli.net/2021/09/05/SITMou8bx3w9FLQ.png)



### 特征值性质

![image-20210905221655344](https://i.loli.net/2021/09/05/aTo2J5XWznNsKbS.png)

### 观测器+控制器

![image-20210905222222861](https://i.loli.net/2021/09/05/6GZ2yu4sxb819Hc.png)

![image-20210905222318790](https://i.loli.net/2021/09/05/JRHozGXajElx7IB.png)

![image-20210905222346703](https://i.loli.net/2021/09/05/dgXRwam5N3CexoZ.png)

## 非线性系统

### 基础定义

![image-20210905222940282](https://i.loli.net/2021/09/05/tNrm7XlJEC5RY1G.png)

### 李雅普诺夫函数

![image-20210905223210982](https://i.loli.net/2021/09/05/OPd45nWNJ17CDBT.png)

![image-20210905223324652](https://i.loli.net/2021/09/05/yGw56TaWjUSrQlx.png)



## LQG



## MPC



## PID





