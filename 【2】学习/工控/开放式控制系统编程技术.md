# 开放式控制系统编程技术

## 概述

> IEC 61131-3标准

*CODESYS完全基于IEC 61161-3标准开发*

> 软PLC

PLC从硬件结构可以分为**硬PLC**和**软PLC**：

* 硬PLC：由硬件或者一块专用的ASIC芯片实现PLC指令的执行
* 软PLC：SoftPLC，使用个人计算机PC或者嵌入式控制器作为硬件平台，利用软件实现硬PLC的基本功能，或者说，将PLC的控制功能封装在软件内，运行于PC或者嵌入式控制器的环境中



**软PLC组成：**

* 开发系统：主要负责编写逻辑程序，对软件进行开发
* 对象控制器系统及I/O模块：PLC的核心，主要负责对采集的I/O信号进行处理，具备逻辑控制及信号输出的功能



> CODESYS软件模型

* 设备：模型的最上层
  * 等效于一个PLC需要的所有软件的集合
  * 代表了一个具体的目标，即硬件对象
* 应用：第二层
  * 每一个设备中有一个或者多个应用，反映了PLC的物理结构，在程序和plc物理io通道之间提供了一个接口
  * 应用分配在一个plc的cpu中，可以将应用理解为一个plc中的微处理单元，在应用内定义的全局变量在该应用内部是有效的
  * 应用的主要成员包括：全局变量、任务和程序组织单元等
* 访问路径：将全局变量、直接表示变量和程序组织单元的输入/输出变量联系起来，实现信息的存储
* 通信功能：提供与其他系统数据通信



> plc执行程序过程

1. 输入采样

   每次扫描周期开始时，PLC检测输入设备的状态，将状态写入输入映像寄存器

2. 程序执行

   plc从输入映像区或者输出映像区读取状态和数据，并依照指令进行逻辑和算数运算，运算的结果保存在输出映像区的单元中

3. 输出刷新

   plc将输出映像区的状态和数据传送到输出点上，并通过一定的方式隔离和功率放大，驱动外部负载



## 语法

### 常数

> 数值常数

二进制整数：2#0010_0010(34)

八进制整数：8#77(63)

十六进制：16#E5(229)



实数：3.1415

布尔数：0，1，True，False



> 布尔常数

TRUE，FALSE，1，0



> time常数

起始符t、T、TIME、time

TIME1 := T#14ms

TIME1 := T#100s12ms

TIME1 := t#12h12s23ms



> DATA常数

起始符d、D、DATE、date

DATA#2021-12-23

d#2021-12-21



> STRING常数

用单引号



> 注释

括号注释：（\*xxx\*）

单行注释：//xxxx

### 变量



> 标识符

* 即变量的名称
* 首字母字母或者下划线
* 不区分大小写



> 声明

普通变量：不需要和硬件外设或通信进行关联的变量

```
<标识符>:<数据类型> {:=<初始值>}
```

直接变量：需要和plc的io或者外部设备进行通信的变量

```
<标识符> AT <地址>:<数据类型> {:=<初始值>}
```

地址的格式：

使用%开头，加位置前缀符号和类型前缀符号，如果有分级，则用整数表示分级

位置前缀符号：

* I：表示输入单元
* Q：输出单元
* M：存储单元

类型前缀符号：

| 类型前缀符号 | 定义                 | 约定数据类型 |
| ------------ | -------------------- | ------------ |
| X            | 位（BIT）            | BOOL         |
| B            | 字节(BYTE)           | BYTE         |
| W            | 字(WORD)             | WORD         |
| D            | 双字(DWORD)          | DWORD        |
| L            | 长字（LWORD）        | LWORD        |
| *            | 未指定，系统自动分配 |              |

```
VAR
	VAR1 AT%ID48:DWORD;
END_VAR
```



### 数据类型

> 标准数据类型

* 布尔：BOOL，8位
* 整型：U、S、D、L
* 实数（浮点数）：REAL、LREAL，32位和64位
* 字符串，STRING
* 时间数据，TIME







